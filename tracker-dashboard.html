<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracker Dashboard - Marlon's Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .card-hover { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-hover:hover { transform: translateY(-4px); }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .rotate-icon { transition: transform 0.3s ease; }
        .rotate-icon.open { transform: rotate(180deg); }
    </style>
</head>
<body class="bg-slate-950">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzYA3xLErpCjTwR7ChH5pNuMWQForc3YzFem0BTOStdkdXz_cGKQVgIx18vvqHN0hfR/exec';

        function Dashboard() {
            const [overdueItems, setOverdueItems] = useState([]);
            const [dueSoonItems, setDueSoonItems] = useState([]);
            const [showOverdue, setShowOverdue] = useState(false);
            const [showDueSoon, setShowDueSoon] = useState(false);
            const [isLoading, setIsLoading] = useState(true);

            const trackers = [
                { name: 'My Training', icon: 'üìö', link: './my-training.html', gradient: 'from-blue-500 to-cyan-500' },
                { name: 'Medical', icon: '‚ù§Ô∏è', link: './medical-tracker.html', gradient: 'from-red-500 to-pink-500' },
                { name: 'Dental', icon: 'üòÅ', link: './dental-tracker.html', gradient: 'from-purple-500 to-pink-500' },
                { name: 'Administration', icon: 'üìã', link: './administration-tracker.html', gradient: 'from-orange-500 to-red-500' },
                { name: 'Miscellaneous', icon: 'üéØ', link: './miscellaneous-tracker.html', gradient: 'from-cyan-500 to-blue-500' }
            ];

            const loadAllData = async () => {
                setIsLoading(true);
                const overdue = [];
                const dueSoon = [];
                
                try {
                    const endpoints = [
                        { action: 'readMyTraining', key: 'mytraining', type: 'Training', warningDays: 180, gradient: 'from-blue-500 to-cyan-500' },
                        { action: 'readMedical', key: 'medical', type: 'Medical', warningDays: 14, gradient: 'from-red-500 to-pink-500' },
                        { action: 'readDental', key: 'dental', type: 'Dental', warningDays: 14, gradient: 'from-purple-500 to-pink-500' },
                        { action: 'readAdministration', key: 'administration', type: 'Administration', warningDays: 14, gradient: 'from-orange-500 to-red-500' },
                        { action: 'readMiscellaneous', key: 'miscellaneous', type: 'Miscellaneous', warningDays: 14, gradient: 'from-cyan-500 to-blue-500' }
                    ];

                    for (const endpoint of endpoints) {
                        try {
                            const res = await fetch(SCRIPT_URL + '?action=' + endpoint.action);
                            const data = await res.json();
                            if (data.success && data[endpoint.key]) {
                                data[endpoint.key].forEach(item => {
                                    const status = calculateStatus(item.dueDate, endpoint.warningDays);
                                    if (status.status === 'overdue') {
                                        overdue.push({
                                            type: endpoint.type,
                                            name: item.name,
                                            daysOverdue: status.days,
                                            gradient: endpoint.gradient
                                        });
                                    } else if (status.status === 'warning') {
                                        dueSoon.push({
                                            type: endpoint.type,
                                            name: item.name,
                                            daysRemaining: status.days,
                                            gradient: endpoint.gradient
                                        });
                                    }
                                });
                            }
                        } catch (error) {
                            console.error('Error loading ' + endpoint.action, error);
                        }
                    }

                    setOverdueItems(overdue.sort((a, b) => b.daysOverdue - a.daysOverdue));
                    setDueSoonItems(dueSoon.sort((a, b) => a.daysRemaining - b.daysRemaining));
                } catch (error) {
                    console.error('Error loading data:', error);
                } finally {
                    setIsLoading(false);
                }
            };

            const calculateStatus = (dueDate, warningDays) => {
                const due = new Date(dueDate);
                const today = new Date();
                const diffTime = due - today;
                const days = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (days < 0) return { status: 'overdue', days: Math.abs(days) };
                if (days <= warningDays) return { status: 'warning', days };
                return { status: 'good', days };
            };

            useEffect(() => {
                loadAllData();
            }, []);

            return (
                <div className="min-h-screen bg-slate-950">
                    {/* Header */}
                    <div className="gradient-bg shadow-2xl">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h1 className="text-4xl font-bold text-white mb-2">Tracker Dashboard</h1>
                                    <p className="text-blue-100 text-lg">Manage all your annual requirements</p>
                                </div>
                                <button onClick={loadAllData} disabled={isLoading}
                                    className="flex items-center space-x-2 px-6 py-3 bg-white/20 backdrop-blur-sm hover:bg-white/30 text-white rounded-xl transition-all duration-200 shadow-lg">
                                    <svg className={`w-5 h-5 ${isLoading ? 'animate-spin' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                    </svg>
                                    <span className="font-medium">Refresh</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {/* Alert Summary Cards */}
                        {(overdueItems.length > 0 || dueSoonItems.length > 0) && (
                            <div className="mb-8">
                                <h2 className="text-2xl font-bold text-white mb-6">Alerts & Renewals</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {/* Overdue Card */}
                                    <div className="bg-slate-900/50 border border-red-500/50 rounded-2xl overflow-hidden shadow-xl">
                                        <button
                                            onClick={() => setShowOverdue(!showOverdue)}
                                            className="w-full p-6 text-left hover:bg-slate-900/70 transition-colors duration-200"
                                        >
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center space-x-4">
                                                    <div className="w-16 h-16 rounded-xl bg-gradient-to-br from-red-500 to-pink-500 flex items-center justify-center text-3xl shadow-lg">
                                                        ‚ö†Ô∏è
                                                    </div>
                                                    <div>
                                                        <div className="text-3xl font-bold text-red-400">{overdueItems.length}</div>
                                                        <div className="text-slate-300 font-medium mt-1">Total Overdue</div>
                                                    </div>
                                                </div>
                                                <svg className={`w-6 h-6 text-slate-400 rotate-icon ${showOverdue ? 'open' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                                                </svg>
                                            </div>
                                        </button>
                                        
                                        {showOverdue && (
                                            <div className="border-t border-red-500/30 bg-slate-950/50">
                                                {overdueItems.map((item, index) => (
                                                    <div key={index} className="p-4 border-b border-slate-800 last:border-b-0 hover:bg-slate-900/30 transition-colors">
                                                        <div className="flex items-center justify-between">
                                                            <div className="flex items-center space-x-3">
                                                                <div className={`w-10 h-10 rounded-lg bg-gradient-to-br ${item.gradient} flex items-center justify-center text-white font-bold text-sm shadow-md`}>
                                                                    {item.type[0]}
                                                                </div>
                                                                <div>
                                                                    <div className="text-white font-medium">{item.name}</div>
                                                                    <div className="text-sm text-slate-400">{item.type}</div>
                                                                </div>
                                                            </div>
                                                            <div className="text-right">
                                                                <div className="text-red-400 font-bold">{item.daysOverdue} days</div>
                                                                <div className="text-xs text-slate-500">overdue</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    {/* Due Soon Card */}
                                    <div className="bg-slate-900/50 border border-yellow-500/50 rounded-2xl overflow-hidden shadow-xl">
                                        <button
                                            onClick={() => setShowDueSoon(!showDueSoon)}
                                            className="w-full p-6 text-left hover:bg-slate-900/70 transition-colors duration-200"
                                        >
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center space-x-4">
                                                    <div className="w-16 h-16 rounded-xl bg-gradient-to-br from-yellow-500 to-orange-500 flex items-center justify-center text-3xl shadow-lg">
                                                        ‚è∞
                                                    </div>
                                                    <div>
                                                        <div className="text-3xl font-bold text-yellow-400">{dueSoonItems.length}</div>
                                                        <div className="text-slate-300 font-medium mt-1">Due Soon</div>
                                                    </div>
                                                </div>
                                                <svg className={`w-6 h-6 text-slate-400 rotate-icon ${showDueSoon ? 'open' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                                                </svg>
                                            </div>
                                        </button>
                                        
                                        {showDueSoon && (
                                            <div className="border-t border-yellow-500/30 bg-slate-950/50">
                                                {dueSoonItems.map((item, index) => (
                                                    <div key={index} className="p-4 border-b border-slate-800 last:border-b-0 hover:bg-slate-900/30 transition-colors">
                                                        <div className="flex items-center justify-between">
                                                            <div className="flex items-center space-x-3">
                                                                <div className={`w-10 h-10 rounded-lg bg-gradient-to-br ${item.gradient} flex items-center justify-center text-white font-bold text-sm shadow-md`}>
                                                                    {item.type[0]}
                                                                </div>
                                                                <div>
                                                                    <div className="text-white font-medium">{item.name}</div>
                                                                    <div className="text-sm text-slate-400">{item.type}</div>
                                                                </div>
                                                            </div>
                                                            <div className="text-right">
                                                                <div className="text-yellow-400 font-bold">{item.daysRemaining} days</div>
                                                                <div className="text-xs text-slate-500">remaining</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* All Clear Message */}
                        {overdueItems.length === 0 && dueSoonItems.length === 0 && !isLoading && (
                            <div className="mb-8 bg-slate-900/50 border border-green-500/50 rounded-2xl p-12 text-center">
                                <div className="text-6xl mb-4">‚úÖ</div>
                                <h3 className="text-2xl font-bold text-green-400 mb-2">All Clear!</h3>
                                <p className="text-slate-400 text-lg">No items require immediate attention</p>
                            </div>
                        )}

                        {/* Trackers Grid */}
                        <div>
                            <h2 className="text-2xl font-bold text-white mb-6">Your Trackers</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {trackers.map((tracker, index) => (
                                    <a key={index} href={tracker.link}
                                        className="card-hover block bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-2xl p-6 hover:border-slate-700 transition-all duration-300 shadow-xl">
                                        <div className={`w-16 h-16 rounded-xl bg-gradient-to-br ${tracker.gradient} flex items-center justify-center mb-4 shadow-lg text-3xl`}>
                                            {tracker.icon}
                                        </div>
                                        <h3 className="text-xl font-bold text-white mb-2">{tracker.name}</h3>
                                        <p className="text-slate-400 text-sm mb-4">Click to manage items</p>
                                        <div className="flex items-center text-sm font-medium text-slate-300">
                                            <span>Open tracker</span>
                                            <svg className="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                                            </svg>
                                        </div>
                                    </a>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>
