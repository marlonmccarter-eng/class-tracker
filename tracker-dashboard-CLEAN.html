<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marlon's Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const SCRIPT_URL = 'YOUR_SCRIPT_URL_HERE';
        
        const Bell = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
        );
        const CheckCircle = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
        );
        const BookOpen = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
            </svg>
        );
        const Activity = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </svg>
        );
        const Heart = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
        );
        const Smile = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                <line x1="9" y1="9" x2="9.01" y2="9"></line>
                <line x1="15" y1="9" x2="15.01" y2="9"></line>
            </svg>
        );
        const FileText = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
        );
        const Target = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <circle cx="12" cy="12" r="6"></circle>
                <circle cx="12" cy="12" r="2"></circle>
            </svg>
        );
        const ChevronRight = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        );

        function Dashboard() {
            const [alerts, setAlerts] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [allCurrent, setAllCurrent] = useState(false);

            useEffect(() => {
                loadAlerts();
            }, []);

            const loadAlerts = async () => {
                if (SCRIPT_URL === 'YOUR_SCRIPT_URL_HERE') {
                    setIsLoading(false);
                    return;
                }

                try {
                    const response = await fetch(SCRIPT_URL + '?action=getAllData');
                    const data = await response.json();

                    console.log('Dashboard loaded data:', data);

                    if (data.success) {
                        const allAlerts = [];

                        // Process classes
                        if (data.mytraining && data.mytraining.length > 0) {
                            data.mytraining.forEach(cls => {
                                const status = calculateStatus(cls.dueDate, 14);
                                if (status.status !== 'good') {
                                    allAlerts.push({
                                        type: 'Training',
                                        name: cls.name,
                                        status: status.status,
                                        message: status.status === 'overdue' ? `${status.days} days overdue` : `Due in ${status.days} days`,
                                        color: status.color
                                    });
                                }
                            });
                        }


                        // Process medical
                        if (data.medical && data.medical.length > 0) {
                            data.medical.forEach(med => {
                                const status = calculateStatus(med.dueDate, 30);
                                if (status.status !== 'good') {
                                    allAlerts.push({
                                        type: 'Medical',
                                        name: med.name,
                                        status: status.status,
                                        message: status.status === 'overdue' ? `${status.days} days overdue` : `Due in ${status.days} days`,
                                        color: status.color
                                    });
                                }
                            });
                        }

                        // Process dental
                        if (data.dental && data.dental.length > 0) {
                            data.dental.forEach(dent => {
                                const status = calculateStatus(dent.dueDate, 30);
                                if (status.status !== 'good') {
                                    allAlerts.push({
                                        type: 'Dental',
                                        name: dent.name,
                                        status: status.status,
                                        message: status.status === 'overdue' ? `${status.days} days overdue` : `Due in ${status.days} days`,
                                        color: status.color
                                    });
                                }
                            });
                        }

                        // Process administration
                        if (data.administration && data.administration.length > 0) {
                            data.administration.forEach(admin => {
                                const status = calculateStatus(admin.dueDate, 14);
                                if (status.status !== 'good') {
                                    allAlerts.push({
                                        type: 'Administration',
                                        name: admin.name,
                                        status: status.status,
                                        message: status.status === 'overdue' ? `${status.days} days overdue` : `Due in ${status.days} days`,
                                        color: status.color
                                    });
                                }
                            });
                        }

                        // Process miscellaneous
                        if (data.miscellaneous && data.miscellaneous.length > 0) {
                            data.miscellaneous.forEach(sim => {
                                const status = calculateStatus(sim.dueDate, 14);
                                if (status.status !== 'good') {
                                    allAlerts.push({
                                        type: 'Miscellaneous',
                                        name: sim.name,
                                        status: status.status,
                                        message: status.status === 'overdue' ? `${status.days} days overdue` : `Due in ${status.days} days`,
                                        color: status.color
                                    });
                                }
                            });
                        }

                        allAlerts.sort((a, b) => {
                            if (a.status === 'overdue' && b.status !== 'overdue') return -1;
                            if (a.status !== 'overdue' && b.status === 'overdue') return 1;
                            return 0;
                        });

                        setAlerts(allAlerts);
                        setAllCurrent(allAlerts.length === 0);
                    }
                } catch (error) {
                    console.error('Error loading alerts:', error);
                } finally {
                    setIsLoading(false);
                }
            };

            const calculateStatus = (dueDate, warningDays) => {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const due = new Date(dueDate);
                due.setHours(0, 0, 0, 0);
                const diffTime = due - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                if (diffDays < 0) return { status: 'overdue', color: 'red', days: Math.abs(diffDays) };
                else if (diffDays <= warningDays) return { status: 'warning', color: 'yellow', days: diffDays };
                else return { status: 'good', color: 'green', days: diffDays };
            };

            const trackers = [
                { name: 'My Training', description: 'Track annual training and certifications', icon: BookOpen, link: './my-training.html', color: 'blue' },
                { name: 'Medical Tracker', description: 'Track medical appointments and exams', icon: Heart, link: './medical-tracker.html', color: 'red' },
                { name: 'Dental Tracker', description: 'Track annual dental checkups', icon: Smile, link: './dental-tracker.html', color: 'purple' },
                { name: 'Administration Tracker', description: 'Track annual administration requirements', icon: FileText, link: './administration-tracker.html', color: 'orange' },
                { name: 'Miscellaneous Tracker', description: 'Track items with custom due dates', icon: Target, link: './miscellaneous-tracker.html', color: 'cyan' }
            ];

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 md:p-6">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">Marlon's Tracker</h1>
                            <p className="text-gray-600">Manage all your requirements in one place</p>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div className="flex items-center mb-4">
                                <Bell className="w-6 h-6 text-orange-500 mr-2" />
                                <h2 className="text-xl font-bold text-gray-800">Upcoming Renewals & Alerts</h2>
                            </div>

                            {isLoading ? (
                                <div className="text-center py-8 text-gray-500">Loading alerts...</div>
                            ) : allCurrent ? (
                                <div className="bg-green-50 border-l-4 border-green-500 p-4 rounded-r-lg">
                                    <div className="flex items-center">
                                        <CheckCircle className="w-6 h-6 text-green-600 mr-3" />
                                        <div>
                                            <h3 className="text-lg font-semibold text-green-800">All Up to Date! ðŸŽ‰</h3>
                                            <p className="text-green-700">You have no upcoming renewals or overdue items.</p>
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <div className="space-y-3">
                                    {alerts.map((alert, index) => (
                                        <div key={index} className={`p-4 rounded-lg border-l-4 ${alert.color === 'red' ? 'bg-red-50 border-red-500' : 'bg-yellow-50 border-yellow-500'}`}>
                                            <div className="flex items-center">
                                                <span className="text-2xl mr-2">{alert.color === 'red' ? 'ðŸ”´' : 'ðŸŸ¡'}</span>
                                                <div>
                                                    <h3 className={`font-semibold ${alert.color === 'red' ? 'text-red-900' : 'text-yellow-900'}`}>{alert.name}</h3>
                                                    <p className={`text-sm ${alert.color === 'red' ? 'text-red-700' : 'text-yellow-700'}`}>
                                                        {alert.message}
                                                        {alert.extra && <span className="ml-2">â€¢ {alert.extra}</span>}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-4">Your Trackers</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {trackers.map((tracker, index) => {
                                    const Icon = tracker.icon;
                                    const colorClasses = {
                                        blue: 'from-blue-50 to-blue-100 hover:from-blue-100 hover:to-blue-200 text-blue-600',
                                        green: 'from-green-50 to-green-100 hover:from-green-100 hover:to-green-200 text-green-600',
                                        red: 'from-red-50 to-red-100 hover:from-red-100 hover:to-red-200 text-red-600',
                                        purple: 'from-purple-50 to-purple-100 hover:from-purple-100 hover:to-purple-200 text-purple-600',
                                        orange: 'from-orange-50 to-orange-100 hover:from-orange-100 hover:to-orange-200 text-orange-600',
                                        cyan: 'from-cyan-50 to-cyan-100 hover:from-cyan-100 hover:to-cyan-200 text-cyan-600'
                                    };
                                    return (
                                        <a key={index} href={tracker.link} className={`block p-6 bg-gradient-to-br ${colorClasses[tracker.color]} rounded-lg border-2 border-transparent hover:border-gray-300 transition-all duration-200 group`}>
                                            <div className="flex items-start justify-between">
                                                <div className="flex-1">
                                                    <div className="flex items-center mb-2">
                                                        <Icon className={`w-8 h-8 ${colorClasses[tracker.color].split(' ').pop()} mr-3`} />
                                                        <h3 className="text-lg font-bold text-gray-800">{tracker.name}</h3>
                                                    </div>
                                                    <p className="text-sm text-gray-600">{tracker.description}</p>
                                                </div>
                                                <ChevronRight className="w-5 h-5 text-gray-400 group-hover:text-gray-600 group-hover:translate-x-1 transition-all" />
                                            </div>
                                        </a>
                                    );
                                })}
                            </div>
                        </div>

                        <div className="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h3 className="font-semibold text-blue-900 mb-2">ðŸ“Š Dashboard Overview</h3>
                            <p className="text-sm text-blue-800">
                                This dashboard shows alerts from all your trackers. Click on a tracker to manage it in detail. All data is automatically synced with Google Sheets.
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Dashboard />);
    </script>
</body>
</html>
